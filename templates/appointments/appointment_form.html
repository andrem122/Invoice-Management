{% extends "base_appointment.html" %}

{% load bootstrap_tags %}

{% block title %}New reminder{% endblock title %}
{% block page_css %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker.min.css" />
{% endblock page_css %}

{% block content %}
  <div class="row">
    <div class="col-lg-9">
      <div class="page-header">
        <h1>
          {% if not object.pk %}
            New appointment
          {% else %}
            Edit appointment
          {% endif %}
          </h1>
      </div>

      <form class="form-horizontal" method="post">
        {% csrf_token %}
        {{ form|as_bootstrap_horizontal }}
        <div class="form-group">
          <div class="col-sm-offset-2 col-sm-10">
            <a href="#back" class="btn btn-default">Cancel</a>
            <button type="submit" class="btn btn-primary">
              {% if not object.pk %}
                Create appointment
              {% else %}
                Update appointment
              {% endif %}
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>

{% endblock %}

{% block page_js %}
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/js/bootstrap-datetimepicker.min.js"></script>
{{ appointments|json_script:"appointments_time" }}
  <script type="text/javascript">
      var format = "MM/DD/YYYY hh:mm A";
      var appointments = JSON.parse(document.getElementById('appointments_time').textContent);

      function create_moments(appointments) {

        var appointmentsLength = appointments.length;
        var moments_array = [];
        for (var i = 0; i < appointmentsLength; i++) {

          time_slot = [];
          for (var j = 0; j < 2; j++) {
            var this_moment = moment(appointments[i][j], format);
            time_slot.push(this_moment);

          }

          moments_array.push(time_slot);

        }

        return moments_array;
      }

      r = create_moments(appointments);
      console.log(r);
      $(function() {
          $('#id_time').datetimepicker({
            format: 'MM/DD/YYYY hh:mm A',
            extraFormats: ['YYYY-MM-DD hh:mm:ss A'],
            sideBySide: true,
            inline: true,
            daysOfWeekDisabled: [0],
            stepping: 30,
            enabledHours: [9, 10, 11, 12, 13, 14, 15, 16, 17],
            disabledTimeIntervals: r,
          });
      });
  </script>
{% endblock %}
