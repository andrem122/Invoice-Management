{% extends 'base_login.html' %}

{% load humanize %}
{% load static %}

{% block title %}Jobs{% endblock title %}

{% block body_class %}jobs{% endblock body_class %}
{% block content %}
{% if new_user %}
<div class="welcome-message">
  <h3>Welcome to Your Job Dashboard!</h3>
  <p>
    Here is where you can add new jobs and request payments for
    existing jobs. Click the blue button above titled 'Add Job' to
    add your first job.
  </p>
</div>
{% endif %}
{% if approved_houses %}
<h2>Active Jobs</h2>
{% endif %}
{% for approved_house in approved_houses %}
<div class="job-container">
  <div class="house">
    <h3 class="house-address">{{approved_house.house.address}}</h3>
  </div>
  <div class="jobs">
    <table class="job-summary">
      <tr class="job-headings">
        <th>Job ID</th>
        <th>Amount</th>
        <th>Balance</th>
        <th>Contract Link</th>
        <th>Request Payment</th>
      </tr>
      <tr class="spacer"></tr>
      {% for job in approved_jobs %}
      {% if job.house.address == approved_house.house.address %}
      <tr class="job-info">
        <td>{{job.id}}</td>
        <td>${{job.start_amount|intcomma}}</td>
        <td>${{job.balance_amount|intcomma}}</td>
        <td><a rel="noopener noreferrer" target="_blank" href="{{job.document_link.url}}">View Contract</a></td>
        <td>
          <form class="request-payment-form" action="" method="post">
            {% csrf_token %}
            {% if form.errors %}
            <div class="form-messages">
              <p>Please try again.</p>
            </div>
            {% endif %}
            {{form}}
            <input type="hidden" name="job_id" value="{{job.id}}">
            <a class="custom-btn blue-slide-btn" href="#">
              <p class="request-payment-p">Request Payment</p>
            </a>
          </form>
        </td>
      </tr>
      {% endif %}
      {% endfor %}
    </table>
  </div>
</div> <!-- /.job-container -->
{% endfor %}
{% if gen_has_results %}
<h2>Pending Approval Jobs</h2>
{% endif %}
{% for house in unapproved_houses %}
<div class="job-container">
  <div class="house">
    <h3 class="house-address">{{house.address}}</h3>
  </div>
  <div class="jobs">
    <table class="job-summary">
      <tr class="job-headings">
        <th>Job ID</th>
        <th>Amount</th>
        <th>Submit Date</th>
        <th>Contract Link</th>
      </tr>
      <tr class="spacer"></tr>
      {% for job in unapproved_jobs %}
      {% if job.house.address == house.address %}
      <tr class="job-info">
        <td>{{job.id}}</td>
        <td>${{job.start_amount|intcomma}}</td>
        <td>{{job.start_date}}</td>
        <td><a href="{{job.document_link.url}}">View Contract</a></td>
      </tr>
      {% endif %}
      {% endfor %}
    </table>
  </div>
</div> <!-- /.job-container -->
{% endfor %}
{% endblock content %}
