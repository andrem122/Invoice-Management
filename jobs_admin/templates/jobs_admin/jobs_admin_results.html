{% extends 'standard_items_customer_6.html' %}

{% load humanize %}
{% load jobs_admin_group_check %}

{# Item Desktop Headings #}
{% block item_heading_1 %}Status{% endblock item_heading_1 %}
{% block item_heading_2 %}Company{% endblock item_heading_2 %}
{% block item_heading_3 %}Balance{% endblock item_heading_3 %}
{% block item_heading_4 %}Contract Link{% endblock item_heading_4 %}
{% block item_heading_5 %}Submitted{% endblock item_heading_5 %}
{% block item_heading_6 %}Amount{% endblock item_heading_6 %}

{# Forms #}
{% block option_forms %}
  {# Approve Job Form #}
  <form id="approve-job-form-{{item.id}}" class="approve-job-form" action="" method="post">
    {% csrf_token %}
    {% if approve_form.errors %}
    <div class="form-messages">
      <p>Please try again.</p>
    </div>
    {% endif %}
    {{ approve_form }}
    <input type="hidden" name="job_id" value="{{item.id}}">
    <input type="hidden" name="approve_job" value="approve_job">
  </form>

  {# Approve As Payment Form #}
  <form id="approve-as-payment-form-{{item.id}}" class="approve-as-payment-form" action="" method="post">
    {% csrf_token %}
    {% if approve_as_payment_form.errors %}
    <div class="form-messages">
      <p>Please try again.</p>
    </div>
    {% endif %}
    {{ approve_as_payment_form }}
    <input type="hidden" name="job_id" value="{{item.id}}">
    <input type="hidden" name="approve-as-payment" value="approve-as-payment">
  </form>

  {# Reject Form #}
  <form id="reject-form-{{item.id}}" class="reject-form" action="" method="post">
    {% csrf_token %}
    {% if reject_estimate_form.errors %}
    <div class="form-messages">
      <p>Please try again.</p>
    </div>
    {% endif %}
    {{ reject_estimate_form }}
    <input type="hidden" name="job_id" value="{{item.id}}">
    <input type="hidden" name="reject_estimate" value="reject_estimate">
  </form>

{% endblock option_forms %}

{% block popup_forms %}
  {# Edit Job Form #}
  <form id="edit-job-form-{{ item.id }}" class="edit-job-form popup" action="" method="post">
    <div class="exit-on-click">
       <i class="fas fa-times popup_remove_trigger"></i>
    </div>
    <h2>Edit Job</h2>
    {% csrf_token %}
    {% if edit_job_form.errors %}
    <div class="form-messages">
      <p>Please try again.</p>
    </div>
    {% endif %}

    <div class="input-label-wrap">
      <div class="label-wrap">{{ edit_job_form.house.label_tag }}</div>
      <div class="input-wrap input-wrap-select">
        <i class="fas fa-home"></i>
        <select id="id_house" name="house">
          <option selected value="">
            House
          </option>
          {% for house in edit_job_form.fields.house.queryset %}
            <option value="{{ house.id }}">{{ house }}</option>
          {% endfor %}
        </select>
      </div>
    </div>

    <div class="input-label-wrap">
      <div class="label-wrap">{{ edit_job_form.company.label_tag }}</div>
      <div class="input-wrap input-wrap-select">
        <i class="far fa-building"></i>
        <select id="id_company" name="company">
          <option selected value="">
            Company
          </option>
          {% for company in edit_job_form.fields.company.queryset %}
            <option value="{{ company.id }}">{{ company }}</option>
          {% endfor %}
        </select>
      </div>
    </div>

    <div class="input-label-wrap">
      <div class="label-wrap">{{ edit_job_form.start_amount.label_tag }}</div>
      <div class="input-wrap"><i class="fas fa-dollar-sign"></i>{{ edit_job_form.start_amount }}</div>
    </div>

    <div class="input-label-file-wrap">
      <div class="label-wrap">{{ edit_job_form.document_link.label_tag }}</div>
      <div class="file-wrap">
        <i class="fas fa-upload"></i>
        <button type="button" class="file-upload-btn">Upload File</button>
        {{ edit_job_form.document_link }}
        <div id="file-input-message"></div>
      </div>
    </div>

    <div class="input-label-wrap">
      <div class="label-wrap">{{ edit_job_form.notes.label_tag }}</div>
      <div class="input-wrap">
        <textarea name="notes" cols="40" rows="10" maxlength="3000" required="" id="id_notes">{{ item.notes }}</textarea>
      </div>
    </div>

    <input type="hidden" name="job_id" value="{{ item.id }}" />
    <input type="hidden" name="edit_job" value="edit_job" />
    <input class="form-submit-btn" type="submit" value="Save" />
  </form>
{% endblock popup_forms %}

{# Item Status #}
{% block item_status %}
  {% if item.approved == False and item.rejected == False %}
  <div class="status new">New</div>

  {% elif item.approved == True and item.balance > 0 %}
  <div class="status active">Active</div>

  {% elif item.approved == True %}
  <div class="status approved">Completed</div>

  {% elif item.rejected == True %}
  <div class="status rejected">Rejected</div>
  {% endif %}
{% endblock item_status %}

{# Mobile Item Headings and Values #}
{% block item_heading_1_m %}Company{% endblock item_heading_1_m %}
{% block item_heading_1_m_v %}{{ item.company }}{% endblock item_heading_1_m_v %}

{% block item_2_m %}
  {% if item.approved == True %}
  <span class="info-title">Balance</span>
  <li class="info-1">
    ${{ item.balance_amount|intcomma }}
  </li>
  <hr>
  {% endif %}
{% endblock item_2_m %}

{% block item_heading_3_m %}Contract Link{% endblock item_heading_3_m %}
{% block item_heading_3_m_v %}<a rel="noopener noreferrer" target="_blank" href="{{ item.document_link.url }}">View Contract</a>{% endblock item_heading_3_m_v %}

{% block item_heading_4_m %}Submitted{% endblock item_heading_4_m %}
{% block item_heading_4_m_v %}{{ item.start_date|date:'M j, g:i a' }}{% endblock item_heading_4_m_v %}

{% block item_heading_5_m %}Amount{% endblock item_heading_5_m %}
{% block item_heading_5_m_v %}${{ item.start_amount|intcomma }}{% endblock item_heading_5_m_v %}

{# Option Buttons #}
{% block mobile_option_btns %}
  {# Approved Item #}
  {% if item.approved == True %}

    <li>
      <button type="submit" form="reject-form-{{ item.id }}" class="option-item mobile-option-item reject-option-m popup_remove_trigger">
        <span>Reject</span><i class="option-item fas fa-times"></i>
      </button>
    </li>

  {# Rejected Item #}
  {% elif item.rejected == True %}

    <li class="approve-payment-option-m">
      <button type="submit" form="approve-as-payment-form-{{ item.id }}" class="option-item mobile-option-item approve-payment-option-m popup_remove_trigger">
        <span>Payment</span><i class="option-item far fa-money-bill-alt"></i>
      </button>
    </li>

    <li>
      <button type="submit" form="approve-job-form-{{ item.id }}" class="option-item mobile-option-item approve-option-m popup_remove_trigger">
        <span>Approve</span><i class="option-item fas fa-check"></i>
      </button>
    </li>

  {# New Item #}
  {% else %}

    <li>
      <button type="submit" form="approve-as-payment-form-{{ item.id }}" class="option-item mobile-option-item approve-payment-option-m popup_remove_trigger">
        <span>Payment</span><i class="option-item far fa-money-bill-alt"></i>
      </button>
    </li>

    <li>
      <button type="submit" form="reject-form-{{ item.id }}" class="option-item mobile-option-item reject-option-m popup_remove_trigger">
        <span>Reject</span><i class="option-item fas fa-times"></i>
      </button>
    </li>

    <li>
      <button type="submit" form="approve-job-form-{{ item.id }}" class="option-item mobile-option-item approve-option-m popup_remove_trigger">
        <span>Approve</span><i class="option-item fas fa-check"></i>
      </button>
    </li>

  {% endif %}
  <li>
    <button class="edit-item-popup edit-item-popup-mobile mobile-option-item trigger-within-popup">
      <span>Edit Job</span><i class="far fa-edit"></i>
    </button>
  </li>
{% endblock mobile_option_btns %}

{% block desktop_option_btns %}
  <div class="dropdown-menu
    {% if item.approved == True and item.balance > 0 %}
    dropdown-active
    {% elif item.approved == True %}
    dropdown-new-approved
    {% elif item.rejected == True %}
    dropdown-rejected
    {% else %}
    dropdown-new-approved
    {% endif %}"
  >
    {% if item.approved == True %}
    <button type="submit" form="reject-form-{{item.id}}" class="dropdown-item reject-btn option-item">Reject</button>
    {% elif item.rejected == True %}
    <button type="submit" form="approve-as-payment-form-{{item.id}}" class="dropdown-item approve-payment-option option-item">Approve Payment</button>
    <button type="submit" form="approve-job-form-{{item.id}}" class="dropdown-item approve-job-option option-item">Approve Job</button>
    {% else %}
    <button type="submit" form="approve-as-payment-form-{{item.id}}" class="dropdown-item approve-payment-option option-item">Approve Payment</button>
    <button type="submit" form="approve-job-form-{{item.id}}" class="dropdown-item approve-job-option option-item">Approve Job</button>
    <button type="submit" form="reject-form-{{item.id}}" class="dropdown-item reject-job-option option-item">Reject</button>
    {% endif %}
    <button class="dropdown-item edit-job-option edit-item-popup">Edit Job</button>
  </div>
{% endblock desktop_option_btns %}
